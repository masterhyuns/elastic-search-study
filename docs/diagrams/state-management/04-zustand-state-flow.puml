@startuml zustand-state-flow
' ============================================================
' í…œí”Œë¦¿: Zustand ìƒíƒœ ê´€ë¦¬ í”Œë¡œìš°
' ì‚¬ìš© ì‚¬ë¡€:
'   - Zustand Storeì™€ ì»´í¬ë„ŒíŠ¸ ê°„ ìƒí˜¸ì‘ìš©
'   - ìƒíƒœ ì—…ë°ì´íŠ¸ â†’ ë¦¬ë Œë”ë§ í”Œë¡œìš°
'   - Selectorë¥¼ í†µí•œ ìµœì í™”
'   - Actions/Handlers íŒ¨í„´
' PlantUML íƒ€ì…: Sequence Diagram
' ============================================================

!theme plain
skinparam backgroundColor white

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ìŠ¤íƒ€ì¼ ì •ì˜
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
skinparam sequence {
  ArrowColor Black
  ActorBorderColor Black
  LifeLineBorderColor #888888
  LifeLineBackgroundColor #F8F8F8

  ParticipantBorderColor Black
  ParticipantBackgroundColor #F0F0F0
  ParticipantFontSize 11

  BoxBorderColor #666666
  BoxBackgroundColor #FAFAFA
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' 1. ê¸°ë³¸ í”Œë¡œìš°: ì‚¬ìš©ì ì•¡ì…˜ â†’ ìƒíƒœ ì—…ë°ì´íŠ¸ â†’ ë¦¬ë Œë”ë§
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

actor "ì‚¬ìš©ì" as User
participant "TodoList\nComponent" as TodoList <<React>>
participant "AddTodoForm\nComponent" as AddForm <<React>>
participant "TodoItem\nComponent" as TodoItem <<React>>

box "Zustand Store" #F0F0F0
  participant "useTodoStore" as Store <<hook>>
  participant "State" as State <<store>>
end box

autonumber

== ì´ˆê¸° ë Œë”ë§: Store êµ¬ë… ==

TodoList -> Store : **const { todos } = useTodoStore()**
activate Store
Store -> State : getState()
activate State
State --> Store : { todos: [], addTodo, removeTodo }
deactivate State
Store --> TodoList : todos ë°°ì—´
deactivate Store

note right of TodoList
  **Selectorë¥¼ ì‚¬ìš©í•œ êµ¬ë…**

  ```tsx
  const todos = useTodoStore(state => state.todos)
  ```

  - 'todos'ë§Œ ë³€ê²½ë˜ë©´ ë¦¬ë Œë”ë§
  - ë‹¤ë¥¸ ìƒíƒœ ë³€ê²½ì€ ë¬´ì‹œ
end note

== ì‚¬ìš©ì ì•¡ì…˜: Todo ì¶”ê°€ ==

User -> AddForm : í¼ ì…ë ¥ & ì œì¶œ
activate AddForm

AddForm -> Store : **addTodo(title)**
activate Store
note right
  Handler í˜¸ì¶œ
end note

Store -> State : **set((state) => ({ ... }))**
activate State

State -> State : ìƒíƒœ ì—…ë°ì´íŠ¸\n{ todos: [...old, new] }

State --> Store : ìƒˆë¡œìš´ state
deactivate State

Store -> Store : **subscribers í†µì§€**
note right
  êµ¬ë… ì¤‘ì¸ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ê²Œ
  ìƒíƒœ ë³€ê²½ ì•Œë¦¼
end note

Store --> TodoList : ğŸ”„ **ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±°**
deactivate Store

TodoList -> TodoList : todos ë°°ì—´ ë¹„êµ
note right
  ì´ì „ todos !== ìƒˆ todos
  â†’ ë¦¬ë Œë”ë§ í•„ìš”
end note

TodoList -> TodoItem : **<TodoItem key={id} />**\nìƒˆ ì•„ì´í…œ ë Œë”ë§
activate TodoItem

deactivate AddForm

== ì‚¬ìš©ì ì•¡ì…˜: Todo ì‚­ì œ ==

User -> TodoItem : ì‚­ì œ ë²„íŠ¼ í´ë¦­
activate TodoItem

TodoItem -> Store : **removeTodo(id)**
activate Store

Store -> State : **set((state) => ({ ... }))**
activate State

State -> State : ìƒíƒœ ì—…ë°ì´íŠ¸\n{ todos: filtered }

State --> Store : ìƒˆë¡œìš´ state
deactivate State

Store -> Store : **subscribers í†µì§€**

Store --> TodoList : ğŸ”„ **ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±°**
deactivate Store

TodoList -> TodoList : todos ë°°ì—´ ë¹„êµ
note right
  todos ë°°ì—´ì´ ë³€ê²½ë¨
  â†’ ë¦¬ë Œë”ë§ í•„ìš”
end note

TodoList --> User : UI ì—…ë°ì´íŠ¸ ì™„ë£Œ
deactivate TodoItem

@enduml

' ============================================================
' 2. Zustand Store êµ¬ì¡°ì™€ ì»´í¬ë„ŒíŠ¸ ê´€ê³„ë„
' ============================================================

@startuml zustand-store-structure
!theme plain
skinparam backgroundColor white

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ìŠ¤íƒ€ì¼ ì •ì˜
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
skinparam component {
  BackgroundColor<<store>> #E0E0E0
  BackgroundColor<<component>> #F0F0F0
  BackgroundColor<<selector>> #D8D8D8
  BackgroundColor<<action>> #C8C8C8
  BorderColor Black
  FontSize 11
}

skinparam package {
  BackgroundColor #FAFAFA
  BorderColor #888888
  BorderThickness 2
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' Zustand Store ì •ì˜
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
package "Zustand Store" {
  component "useTodoStore" as Store <<store>> {
    **State**
    ----
    - todos: Todo[]
    - filter: 'all' | 'active' | 'completed'
    - loading: boolean
    ====
    **Actions (Handlers)**
    ----
    + addTodo(title: string): void
    + removeTodo(id: string): void
    + toggleTodo(id: string): void
    + setFilter(filter: FilterType): void
    + fetchTodos(): Promise<void>
    ====
    **Computed (Selectors)**
    ----
    + filteredTodos(): Todo[]
    + activeCount(): number
    + completedCount(): number
  }
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' React ì»´í¬ë„ŒíŠ¸ë“¤
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
package "React Components" {
  component "TodoList" as TodoList <<component>>
  component "AddTodoForm" as AddForm <<component>>
  component "TodoItem" as TodoItem <<component>>
  component "TodoFilter" as TodoFilter <<component>>
  component "TodoStats" as TodoStats <<component>>
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' Selectors (ìµœì í™”)
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
component "Selector:\nstate => state.todos" as TodosSelector <<selector>>
component "Selector:\nstate => state.filteredTodos()" as FilteredSelector <<selector>>
component "Selector:\nstate => state.filter" as FilterSelector <<selector>>
component "Selector:\nstate => state.activeCount()" as StatsSelector <<selector>>

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ê´€ê³„ ì •ì˜
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

' Components â†’ Selectors
TodoList ..> FilteredSelector : subscribes
AddForm ..> Store : uses addTodo()
TodoItem ..> Store : uses toggleTodo()\nuses removeTodo()
TodoFilter ..> FilterSelector : subscribes
TodoFilter ..> Store : uses setFilter()
TodoStats ..> StatsSelector : subscribes

' Selectors â†’ Store
TodosSelector ..> Store : reads state
FilteredSelector ..> Store : reads state
FilterSelector ..> Store : reads state
StatsSelector ..> Store : reads state

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ì£¼ì„
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
note right of Store
  **Store ìƒì„± ì½”ë“œ**

  ```tsx
  import { create } from 'zustand'

  type Todo = {
    id: string
    title: string
    completed: boolean
  }

  type TodoStore = {
    todos: Todo[]
    filter: 'all' | 'active' | 'completed'
    loading: boolean

    // Actions
    addTodo: (title: string) => void
    removeTodo: (id: string) => void
    toggleTodo: (id: string) => void
    setFilter: (filter: 'all' | 'active' | 'completed') => void
    fetchTodos: () => Promise<void>

    // Computed
    filteredTodos: () => Todo[]
    activeCount: () => number
  }

  export const useTodoStore = create<TodoStore>((set, get) => ({
    todos: [],
    filter: 'all',
    loading: false,

    addTodo: (title) => set((state) => ({
      todos: [
        ...state.todos,
        { id: crypto.randomUUID(), title, completed: false }
      ]
    })),

    removeTodo: (id) => set((state) => ({
      todos: state.todos.filter(todo => todo.id !== id)
    })),

    toggleTodo: (id) => set((state) => ({
      todos: state.todos.map(todo =>
        todo.id === id
          ? { ...todo, completed: !todo.completed }
          : todo
      )
    })),

    setFilter: (filter) => set({ filter }),

    fetchTodos: async () => {
      set({ loading: true })
      const todos = await fetch('/api/todos').then(r => r.json())
      set({ todos, loading: false })
    },

    // Computed getters
    filteredTodos: () => {
      const { todos, filter } = get()
      if (filter === 'active') return todos.filter(t => !t.completed)
      if (filter === 'completed') return todos.filter(t => t.completed)
      return todos
    },

    activeCount: () => get().todos.filter(t => !t.completed).length
  }))
  ```
end note

note left of TodoList
  **ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì˜ˆì‹œ**

  ```tsx
  // 1. ì „ì²´ êµ¬ë… (ë¹„íš¨ìœ¨)
  const { todos, addTodo } = useTodoStore()

  // 2. Selectorë¡œ ìµœì í™” â­ ì¶”ì²œ
  const todos = useTodoStore(state => state.todos)
  const addTodo = useTodoStore(state => state.addTodo)

  // 3. Computed ì‚¬ìš©
  const filteredTodos = useTodoStore(
    state => state.filteredTodos()
  )

  // 4. ì—¬ëŸ¬ ê°’ ì„ íƒ (shallow ë¹„êµ)
  const { todos, filter } = useTodoStore(
    state => ({ todos: state.todos, filter: state.filter }),
    shallow
  )
  ```

  **ë¦¬ë Œë”ë§ ìµœì í™”**:
  - Selector ì‚¬ìš© ì‹œ í•´ë‹¹ ê°’ë§Œ ë³€ê²½ë˜ë©´ ë¦¬ë Œë”ë§
  - ì „ì²´ êµ¬ë… ì‹œ ëª¨ë“  ìƒíƒœ ë³€ê²½ì— ë¦¬ë Œë”ë§
end note

note bottom of TodoFilter
  **TodoFilter ì»´í¬ë„ŒíŠ¸**

  ```tsx
  export const TodoFilter = () => {
    const filter = useTodoStore(state => state.filter)
    const setFilter = useTodoStore(state => state.setFilter)

    return (
      <div>
        <button
          onClick={() => setFilter('all')}
          disabled={filter === 'all'}
        >
          All
        </button>
        <button
          onClick={() => setFilter('active')}
          disabled={filter === 'active'}
        >
          Active
        </button>
        <button
          onClick={() => setFilter('completed')}
          disabled={filter === 'completed'}
        >
          Completed
        </button>
      </div>
    )
  }
  ```

  **ìµœì í™” í¬ì¸íŠ¸**:
  - filterë§Œ êµ¬ë… â†’ filter ë³€ê²½ ì‹œë§Œ ë¦¬ë Œë”ë§
  - setFilterëŠ” í•¨ìˆ˜ë¼ì„œ ë³€ê²½ ì•ˆ ë¨ (ì•ˆì •ì )
end note

@enduml

' ============================================================
' 3. ê³ ê¸‰ íŒ¨í„´: Middleware & DevTools
' ============================================================

@startuml zustand-advanced-patterns
!theme plain
skinparam backgroundColor white

skinparam activity {
  BackgroundColor #F0F0F0
  BorderColor Black
  DiamondBackgroundColor #E0E0E0
  DiamondBorderColor Black
  FontSize 11
}

|ì»´í¬ë„ŒíŠ¸|
start
:ì‚¬ìš©ì ì•¡ì…˜\n(ë²„íŠ¼ í´ë¦­);

|Zustand Store|
:Action í˜¸ì¶œ\n**addTodo(title)**;

if (Middleware: Immer) then (ì‚¬ìš©)
  :Immerë¡œ ë¶ˆë³€ì„± ìë™ ê´€ë¦¬;
  note right
    ```tsx
    import { immer } from 'zustand/middleware/immer'

    create<TodoStore>()(
      immer((set) => ({
        addTodo: (title) => set((state) => {
          // ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥ (Immerê°€ ë¶ˆë³€ì„± ë³´ì¥)
          state.todos.push({
            id: crypto.randomUUID(),
            title,
            completed: false
          })
        })
      }))
    )
    ```
  end note
else (ë¯¸ì‚¬ìš©)
  :ìˆ˜ë™ spread ì—°ì‚°ì;
endif

if (Middleware: Persist) then (ì‚¬ìš©)
  :localStorageì— ì €ì¥;
  note right
    ```tsx
    import { persist } from 'zustand/middleware'

    create<TodoStore>()(
      persist(
        (set) => ({
          todos: [],
          addTodo: (title) => set(...)
        }),
        {
          name: 'todo-storage',
          storage: createJSONStorage(() => localStorage)
        }
      )
    )
    ```
  end note
else (ë¯¸ì‚¬ìš©)
  :ë©”ëª¨ë¦¬ë§Œ ì €ì¥;
endif

if (Middleware: DevTools) then (ì‚¬ìš©)
  :Redux DevToolsì— ë¡œê¹…;
  note right
    ```tsx
    import { devtools } from 'zustand/middleware'

    create<TodoStore>()(
      devtools(
        (set) => ({ ... }),
        { name: 'TodoStore' }
      )
    )
    ```
  end note
endif

:ìƒíƒœ ì—…ë°ì´íŠ¸\n**set((state) => ...)**;

|êµ¬ë…ìë“¤|
:ëª¨ë“  êµ¬ë… ì»´í¬ë„ŒíŠ¸ì—ê²Œ í†µì§€;

if (Selector ì¼ì¹˜?) then (yes)
  :ğŸ”„ ë¦¬ë Œë”ë§;
else (no)
  :ë¦¬ë Œë”ë§ ìŠ¤í‚µ;
  note right
    ìµœì í™”!
    í•´ë‹¹ ê°’ì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´
    ë¦¬ë Œë”ë§í•˜ì§€ ì•ŠìŒ
  end note
endif

|ì»´í¬ë„ŒíŠ¸|
:UI ì—…ë°ì´íŠ¸ ì™„ë£Œ;
stop

@enduml

' ============================================================
' 4. ì‹¤ì „ ì˜ˆì œ: ì¥ë°”êµ¬ë‹ˆ (Cart) Store
' ============================================================

@startuml zustand-cart-example
!theme plain
skinparam backgroundColor white

skinparam class {
  BackgroundColor<<store>> #E0E0E0
  BackgroundColor<<type>> #F0F0F0
  BorderColor Black
  FontSize 11
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' íƒ€ì… ì •ì˜
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class CartItem <<type>> {
  + id: string
  + productId: string
  + name: string
  + price: number
  + quantity: number
  + image: string
}

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' Zustand Store
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class useCartStore <<store>> {
  **State**
  ----
  - items: CartItem[]
  - isOpen: boolean
  ====
  **Actions**
  ----
  + addItem(product: Product): void
  + removeItem(id: string): void
  + updateQuantity(id: string, quantity: number): void
  + clearCart(): void
  + toggleCart(): void
  ====
  **Computed Selectors**
  ----
  + totalItems(): number
  + totalPrice(): number
  + isEmpty(): boolean
}

useCartStore *-- CartItem : contains

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' êµ¬í˜„ ì½”ë“œ
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
note right of useCartStore
  **ì¥ë°”êµ¬ë‹ˆ Store êµ¬í˜„**

  ```tsx
  import { create } from 'zustand'
  import { persist } from 'zustand/middleware'

  type Product = {
    id: string
    name: string
    price: number
    image: string
  }

  type CartItem = Product & {
    quantity: number
  }

  type CartStore = {
    items: CartItem[]
    isOpen: boolean

    addItem: (product: Product) => void
    removeItem: (id: string) => void
    updateQuantity: (id: string, quantity: number) => void
    clearCart: () => void
    toggleCart: () => void

    totalItems: () => number
    totalPrice: () => number
    isEmpty: () => boolean
  }

  export const useCartStore = create<CartStore>()(
    persist(
      (set, get) => ({
        items: [],
        isOpen: false,

        addItem: (product) => set((state) => {
          const existingItem = state.items.find(
            item => item.id === product.id
          )

          if (existingItem) {
            // ì´ë¯¸ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ ì¦ê°€
            return {
              items: state.items.map(item =>
                item.id === product.id
                  ? { ...item, quantity: item.quantity + 1 }
                  : item
              )
            }
          }

          // ìƒˆ ì•„ì´í…œ ì¶”ê°€
          return {
            items: [...state.items, { ...product, quantity: 1 }]
          }
        }),

        removeItem: (id) => set((state) => ({
          items: state.items.filter(item => item.id !== id)
        })),

        updateQuantity: (id, quantity) => set((state) => {
          if (quantity <= 0) {
            // ìˆ˜ëŸ‰ 0ì´ë©´ ì‚­ì œ
            return {
              items: state.items.filter(item => item.id !== id)
            }
          }

          return {
            items: state.items.map(item =>
              item.id === id
                ? { ...item, quantity }
                : item
            )
          }
        }),

        clearCart: () => set({ items: [] }),

        toggleCart: () => set((state) => ({
          isOpen: !state.isOpen
        })),

        // Computed getters
        totalItems: () => {
          return get().items.reduce(
            (sum, item) => sum + item.quantity,
            0
          )
        },

        totalPrice: () => {
          return get().items.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0
          )
        },

        isEmpty: () => get().items.length === 0
      }),
      {
        name: 'cart-storage', // localStorage key
        // íŠ¹ì • í•„ë“œë§Œ persist
        partialize: (state) => ({ items: state.items })
      }
    )
  )
  ```
end note

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì˜ˆì‹œ
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
note left of useCartStore
  **ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©**

  ```tsx
  // 1. ProductCard: ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
  export const ProductCard = ({ product }: { product: Product }) => {
    const addItem = useCartStore(state => state.addItem)

    return (
      <div>
        <img src={product.image} alt={product.name} />
        <h3>{product.name}</h3>
        <p>${product.price}</p>
        <button onClick={() => addItem(product)}>
          Add to Cart
        </button>
      </div>
    )
  }

  // 2. CartBadge: ì´ ì•„ì´í…œ ìˆ˜ í‘œì‹œ
  export const CartBadge = () => {
    const totalItems = useCartStore(state => state.totalItems())
    const toggleCart = useCartStore(state => state.toggleCart)

    return (
      <button onClick={toggleCart}>
        ğŸ›’ Cart ({totalItems})
      </button>
    )
  }

  // 3. CartDrawer: ì¥ë°”êµ¬ë‹ˆ ì „ì²´ UI
  export const CartDrawer = () => {
    const items = useCartStore(state => state.items)
    const totalPrice = useCartStore(state => state.totalPrice())
    const removeItem = useCartStore(state => state.removeItem)
    const updateQuantity = useCartStore(state => state.updateQuantity)

    return (
      <div>
        {items.map(item => (
          <div key={item.id}>
            <img src={item.image} alt={item.name} />
            <div>
              <h4>{item.name}</h4>
              <p>${item.price} x {item.quantity}</p>
              <input
                type="number"
                value={item.quantity}
                onChange={(e) => updateQuantity(
                  item.id,
                  parseInt(e.target.value)
                )}
              />
              <button onClick={() => removeItem(item.id)}>
                Remove
              </button>
            </div>
          </div>
        ))}

        <div>
          <strong>Total: ${totalPrice.toFixed(2)}</strong>
          <button>Checkout</button>
        </div>
      </div>
    )
  }
  ```

  **ìµœì í™” í¬ì¸íŠ¸**:
  - ProductCard: addItemë§Œ êµ¬ë… (items ë³€ê²½ ë¬´ì‹œ)
  - CartBadge: totalItems()ë§Œ êµ¬ë… (íš¨ìœ¨ì )
  - CartDrawer: items, totalPriceë§Œ êµ¬ë…
end note

' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
' ë²”ë¡€
' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
legend right
  **Zustand í•µì‹¬ ê°œë…**

  **State**: ì €ì¥í•  ë°ì´í„°
  **Actions**: ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
  **Computed**: íŒŒìƒëœ ê°’ (getters)
  **Selector**: í•„ìš”í•œ ìƒíƒœë§Œ êµ¬ë… (ìµœì í™”)

  **Middleware**:
  - persist: localStorage/sessionStorage ìë™ ì €ì¥
  - immer: ë¶ˆë³€ì„± ìë™ ê´€ë¦¬
  - devtools: Redux DevTools ì—°ë™

  **ìµœì í™” íŒ**:
  1. Selectorë¡œ í•„ìš”í•œ ê°’ë§Œ êµ¬ë…
  2. ActionsëŠ” ì•ˆì •ì  (ë¦¬ë Œë”ë§ ì•ˆ í•¨)
  3. Computed gettersë¡œ íŒŒìƒ ê°’ ê³„ì‚°
  4. shallow ë¹„êµë¡œ ì—¬ëŸ¬ ê°’ ì„ íƒ ì‹œ ìµœì í™”
endlegend

@enduml
