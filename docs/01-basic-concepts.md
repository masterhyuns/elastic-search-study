# Elasticsearch ê¸°ë³¸ ê°œë…

> í˜‘ì—… í”Œë«í¼ ê°œë°œìë¥¼ ìœ„í•œ Elasticsearch í•µì‹¬ ê°œë… ì •ë¦¬

## ğŸ¯ Elasticsearchë€?

**ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„**
- RESTful API ê¸°ë°˜
- JSON ë¬¸ì„œ ì €ì¥
- ì‹¤ì‹œê°„ ê²€ìƒ‰
- ìˆ˜í‰ í™•ì¥(Scale-out) ê°€ëŠ¥

### ì¼ë°˜ DB vs Elasticsearch

| íŠ¹ì„± | RDBMS | Elasticsearch |
|------|-------|---------------|
| ë°ì´í„° êµ¬ì¡° | Table â†’ Row â†’ Column | Index â†’ Document â†’ Field |
| ìŠ¤í‚¤ë§ˆ | ì—„ê²©í•œ ìŠ¤í‚¤ë§ˆ | ìœ ì—°í•œ ë§¤í•‘ |
| ê²€ìƒ‰ ë°©ì‹ | LIKE '%keyword%' (ëŠë¦¼) | Inverted Index (ë¹ ë¦„) |
| ì£¼ ìš©ë„ | íŠ¸ëœì­ì…˜ ì²˜ë¦¬ | ì „ë¬¸ ê²€ìƒ‰ |
| ì¡°ì¸ | ê°•ë ¥í•œ ì¡°ì¸ | ì¡°ì¸ ì§€ì› ì•½í•¨ |

## ğŸ“š í•µì‹¬ ìš©ì–´

### 1. Index (ì¸ë±ìŠ¤)
- **RDBMSì˜ Databaseì™€ ìœ ì‚¬**
- ê´€ë ¨ ë¬¸ì„œë“¤ì˜ ëª¨ìŒ
- ì˜ˆ: `messages`, `users`, `projects`

```json
// ì¸ë±ìŠ¤ ìƒì„± ì˜ˆì‹œ
PUT /messages
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1
  }
}
```

### 2. Document (ë¬¸ì„œ)
- **RDBMSì˜ Rowì™€ ìœ ì‚¬**
- JSON í˜•ì‹ì˜ ë°ì´í„°
- ê³ ìœ í•œ `_id` ë³´ìœ 

```json
// ë¬¸ì„œ ì˜ˆì‹œ
{
  "_id": "msg_001",
  "content": "í”„ë¡œì íŠ¸ ì¼ì • ë…¼ì˜ í•„ìš”",
  "author": "í™ê¸¸ë™",
  "channel": "ê°œë°œíŒ€",
  "created_at": "2025-10-13T10:30:00Z"
}
```

### 3. Field (í•„ë“œ)
- **RDBMSì˜ Columnê³¼ ìœ ì‚¬**
- ë¬¸ì„œ ë‚´ì˜ ê°œë³„ ì†ì„±
- íƒ€ì… ì§€ì • ê°€ëŠ¥ (text, keyword, date, integer ë“±)

### 4. Mapping (ë§¤í•‘)
- **RDBMSì˜ Schemaì™€ ìœ ì‚¬**
- ê° í•„ë“œì˜ íƒ€ì…ê³¼ ë¶„ì„ ë°©ë²• ì •ì˜

```json
// ë§¤í•‘ ì˜ˆì‹œ
PUT /messages/_mapping
{
  "properties": {
    "content": { "type": "text", "analyzer": "nori" },
    "author": { "type": "keyword" },
    "created_at": { "type": "date" }
  }
}
```

## ğŸ” Inverted Index (ì—­ì¸ë±ìŠ¤)

**Elasticsearchê°€ ë¹ ë¥¸ í•µì‹¬ ì´ìœ **

### ì¼ë°˜ ê²€ìƒ‰ (ì„ í˜• íƒìƒ‰)
```
ë¬¸ì„œ1: "ElasticsearchëŠ” ë¹ ë¥´ë‹¤"
ë¬¸ì„œ2: "ê²€ìƒ‰ ì—”ì§„ ë¹„êµ"
ë¬¸ì„œ3: "Elasticsearch ì„¤ì¹˜ ë°©ë²•"

"Elasticsearch" ê²€ìƒ‰ â†’ ëª¨ë“  ë¬¸ì„œ ìˆœíšŒ (ëŠë¦¼)
```

### Inverted Index ë°©ì‹
```
Term           | Document IDs
---------------|-------------
elasticsearch  | [1, 3]
ë¹ ë¥´ë‹¤         | [1]
ê²€ìƒ‰           | [2]
ì—”ì§„           | [2]
ë¹„êµ           | [2]
ì„¤ì¹˜           | [3]
ë°©ë²•           | [3]

"elasticsearch" ê²€ìƒ‰ â†’ ì¦‰ì‹œ [1, 3] ë°˜í™˜ (ë¹ ë¦„)
```

## ğŸ”¤ Analyzer (ë¶„ì„ê¸°)

**í…ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ í† í°ìœ¼ë¡œ ë³€í™˜**

### Analyzer êµ¬ì„± ìš”ì†Œ
1. **Character Filter**: íŠ¹ìˆ˜ë¬¸ì ì œê±° (`<html>` â†’ ``)
2. **Tokenizer**: ë‹¨ì–´ ë¶„ë¦¬ (`"hello world"` â†’ `["hello", "world"]`)
3. **Token Filter**: ì†Œë¬¸ì ë³€í™˜, ë¶ˆìš©ì–´ ì œê±° ë“±

### í•œê¸€ ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±
```
í…ìŠ¤íŠ¸: "Elasticsearchë¥¼ ê³µë¶€í•©ë‹ˆë‹¤"

Standard Analyzer (ê¸°ë³¸):
â†’ ["elasticsearchë¥¼", "ê³µë¶€í•©ë‹ˆë‹¤"]  âŒ ì¡°ì‚¬ í¬í•¨, ê²€ìƒ‰ ì–´ë ¤ì›€

Nori Analyzer (í•œê¸€ í˜•íƒœì†Œ):
â†’ ["elasticsearch", "ê³µë¶€", "í•˜ë‹¤"]  âœ… ì˜ë¯¸ ë‹¨ìœ„ ë¶„ë¦¬
```

## ğŸ¨ Field íƒ€ì…

### Text vs Keyword
```json
{
  "title": {
    "type": "text",        // ì „ë¬¸ ê²€ìƒ‰ìš© (ë¶„ì„ë¨)
    "fields": {
      "keyword": {
        "type": "keyword"  // ì •ë ¬/ì§‘ê³„ìš© (ë¶„ì„ ì•ˆë¨)
      }
    }
  }
}
```

| íƒ€ì… | ë¶„ì„ | ìš©ë„ | ì˜ˆì‹œ |
|------|------|------|------|
| text | O | ì „ë¬¸ ê²€ìƒ‰ | ë©”ì‹œì§€ ë‚´ìš©, ë¬¸ì„œ ë³¸ë¬¸ |
| keyword | X | í•„í„°/ì •ë ¬/ì§‘ê³„ | ì‚¬ìš©ì ID, íƒœê·¸, ìƒíƒœê°’ |
| date | X | ë‚ ì§œ ë²”ìœ„ ê²€ìƒ‰ | ìƒì„±ì¼, ìˆ˜ì •ì¼ |
| integer/long | X | ìˆ«ì ë²”ìœ„ ê²€ìƒ‰ | ì¡°íšŒìˆ˜, ì¢‹ì•„ìš” ìˆ˜ |
| boolean | X | ì°¸/ê±°ì§“ í•„í„° | ê³µê°œ ì—¬ë¶€, ì™„ë£Œ ìƒíƒœ |

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œë…

### Cluster (í´ëŸ¬ìŠ¤í„°)
- í•˜ë‚˜ ì´ìƒì˜ ë…¸ë“œë¡œ êµ¬ì„±
- ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰ ê¸°ëŠ¥ ì œê³µ

### Node (ë…¸ë“œ)
- í´ëŸ¬ìŠ¤í„°ì˜ ë‹¨ì¼ ì„œë²„
- ë°ì´í„° ì €ì¥ ë° ê²€ìƒ‰ ì‘ì—… ìˆ˜í–‰

### Shard (ìƒ¤ë“œ)
- ì¸ë±ìŠ¤ë¥¼ ì—¬ëŸ¬ ì¡°ê°ìœ¼ë¡œ ë¶„í• 
- ìˆ˜í‰ í™•ì¥ì„ ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜
- Primary Shard: ì›ë³¸ ë°ì´í„°
- Replica Shard: ë°±ì—… ë°ì´í„° (ê³ ê°€ìš©ì„±)

```
Index: messages (1GB)
â”œâ”€â”€ Shard 0 (Primary): 500MB â†’ Node 1
â”‚   â””â”€â”€ Shard 0 (Replica): 500MB â†’ Node 2
â””â”€â”€ Shard 1 (Primary): 500MB â†’ Node 2
    â””â”€â”€ Shard 1 (Replica): 500MB â†’ Node 1
```

## ğŸ“Š í˜‘ì—… í”Œë«í¼ ì ìš© ê´€ì 

### ê²€ìƒ‰ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì„¤ê³„

#### 1. ë©”ì‹œì§€ ì „ë¬¸ ê²€ìƒ‰
```
í•„ë“œ: content (text, nori analyzer)
ì¿¼ë¦¬: match query
íŠ¹ì§•: í˜•íƒœì†Œ ë¶„ì„ìœ¼ë¡œ "ê³µë¶€í•˜ë‹¤" ê²€ìƒ‰ ì‹œ "ê³µë¶€í•©ë‹ˆë‹¤", "ê³µë¶€í–ˆì–´ìš”" ë§¤ì¹­
```

#### 2. ì‚¬ìš©ìëª… ìë™ì™„ì„±
```
í•„ë“œ: username (keyword + completion)
ì¿¼ë¦¬: prefix query ë˜ëŠ” completion suggester
íŠ¹ì§•: "í™ê¸¸" ì…ë ¥ ì‹œ "í™ê¸¸ë™", "í™ê¸¸ìˆœ" ì œì•ˆ
```

#### 3. ë‹¤ì¤‘ ì¡°ê±´ í•„í„°ë§
```
ì¡°ê±´: ì±„ë„ = "ê°œë°œíŒ€" AND ë‚ ì§œ >= "2025-10-01" AND ì‘ì„±ì IN ["í™ê¸¸ë™", "ê¹€ì² ìˆ˜"]
ì¿¼ë¦¬: bool query (must, filter, should)
```

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

- [02-setup-guide.md](./02-setup-guide.md): ì‹¤ì œ í™˜ê²½ êµ¬ì¶•
- [03-crud-operations.md](./03-crud-operations.md): ê¸°ë³¸ ì‘ì—… ì‹¤ìŠµ

## ğŸ“ í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Inverted Index ê°œë… ì´í•´
- [ ] Mappingì˜ ì¤‘ìš”ì„± ì´í•´
- [ ] Text vs Keyword ì°¨ì´ì  ì´í•´
- [ ] Analyzerì˜ ì—­í•  ì´í•´
- [ ] Shardì™€ Replica ê°œë… ì´í•´
