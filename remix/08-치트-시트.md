# Remix 치트 시트 📋

빠른 참조를 위한 Remix 핵심 패턴 모음입니다.

---

## 📁 프로젝트 설정

### 새 프로젝트 생성
```bash
pnpm create remix@latest my-app
cd my-app
pnpm install
pnpm run dev
```

### 프로젝트 구조
```
app/
├── routes/              # 라우트 파일
├── components/          # 재사용 컴포넌트
├── utils/              # 유틸리티 함수
├── root.tsx            # 루트 레이아웃
└── entry.client.tsx    # 클라이언트 진입점
```

---

## 🛣️ 라우팅

### 파일명 규칙
```
app/routes/
_index.tsx              → /
about.tsx               → /about
blog._index.tsx         → /blog
blog.$slug.tsx          → /blog/:slug
blog.($lang).tsx        → /blog 또는 /blog/:lang
blog.$.tsx              → /blog/* (캐치올)
_auth.login.tsx         → /login (레이아웃만)
```

### 기본 라우트
```typescript
// app/routes/posts._index.tsx
export default function Posts() {
  return <h1>포스트 목록</h1>;
}
```

### 동적 라우트
```typescript
// app/routes/posts.$postId.tsx
import { useParams } from "@remix-run/react";

export default function Post() {
  const { postId } = useParams();
  return <h1>포스트 {postId}</h1>;
}
```

### 중첩 라우트
```typescript
// app/routes/dashboard.tsx (부모)
import { Outlet } from "@remix-run/react";

export default function Dashboard() {
  return (
    <div>
      <nav>사이드바</nav>
      <Outlet /> {/* 자식 라우트 */}
    </div>
  );
}

// app/routes/dashboard.settings.tsx (자식)
export default function Settings() {
  return <h1>설정</h1>;
}
```

---

## 📊 데이터 로딩

### Loader (GET)
```typescript
import { json, LoaderFunctionArgs } from "@remix-run/node";
import { useLoaderData } from "@remix-run/react";

export const loader = async ({ params, request }: LoaderFunctionArgs) => {
  // URL 파라미터
  const id = params.postId;

  // 쿼리 파라미터
  const url = new URL(request.url);
  const page = url.searchParams.get("page") || "1";

  // 데이터 가져오기
  const data = await fetchData(id, page);

  // JSON 응답
  return json({ data });
};

export default function MyRoute() {
  const { data } = useLoaderData<typeof loader>();
  return <div>{data}</div>;
}
```

### Loader 에러 처리
```typescript
export const loader = async ({ params }: LoaderFunctionArgs) => {
  const post = await db.post.findUnique({
    where: { id: params.postId }
  });

  if (!post) {
    throw new Response("Not Found", { status: 404 });
  }

  return json({ post });
};
```

### Loader 리다이렉트
```typescript
export const loader = async ({ request }: LoaderFunctionArgs) => {
  const user = await getUser(request);

  if (!user) {
    return redirect("/login");
  }

  return json({ user });
};
```

---

## ✍️ 데이터 변경

### Action (POST/PUT/DELETE)
```typescript
import { redirect, ActionFunctionArgs } from "@remix-run/node";

export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();

  const title = formData.get("title");
  const content = formData.get("content");

  await db.post.create({
    data: { title, content }
  });

  return redirect("/posts");
};
```

### HTTP 메소드별 처리
```typescript
export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();

  switch (request.method) {
    case "POST":
      return await createPost(formData);
    case "PUT":
      return await updatePost(formData);
    case "DELETE":
      return await deletePost(formData);
    default:
      throw new Response("Method not allowed", { status: 405 });
  }
};
```

### Intent 패턴
```typescript
export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();
  const intent = formData.get("intent");

  switch (intent) {
    case "create":
      return await createItem(formData);
    case "update":
      return await updateItem(formData);
    case "delete":
      return await deleteItem(formData);
  }
};

// 사용
<button name="intent" value="create">생성</button>
<button name="intent" value="delete">삭제</button>
```

---

## 📝 Form

### 기본 Form
```typescript
import { Form } from "@remix-run/react";

<Form method="post">
  <input name="title" />
  <button type="submit">저장</button>
</Form>
```

### GET Form (검색)
```typescript
<Form method="get">
  <input name="search" />
  <button type="submit">검색</button>
</Form>
```

### 에러 표시
```typescript
import { useActionData } from "@remix-run/react";

export default function MyForm() {
  const actionData = useActionData<typeof action>();

  return (
    <Form method="post">
      <input name="email" />
      {actionData?.errors?.email && (
        <p className="error">{actionData.errors.email}</p>
      )}
      <button type="submit">제출</button>
    </Form>
  );
}
```

---

## 🔄 useFetcher

### 기본 사용법
```typescript
import { useFetcher } from "@remix-run/react";

export default function MyComponent() {
  const fetcher = useFetcher();

  return (
    <fetcher.Form method="post" action="/api/subscribe">
      <input name="email" />
      <button type="submit">
        {fetcher.state === "submitting" ? "제출 중..." : "구독"}
      </button>
    </fetcher.Form>
  );
}
```

### 프로그래밍 방식 제출
```typescript
const fetcher = useFetcher();

const handleClick = () => {
  const formData = new FormData();
  formData.append("item", "value");

  fetcher.submit(formData, {
    method: "post",
    action: "/api/action"
  });
};
```

### Loader 데이터 가져오기
```typescript
const fetcher = useFetcher();

useEffect(() => {
  fetcher.load("/api/data");
}, []);

return fetcher.data ? <div>{fetcher.data}</div> : <div>로딩...</div>;
```

---

## 🚦 Navigation

### Link
```typescript
import { Link } from "@remix-run/react";

<Link to="/about">About</Link>
<Link to="/posts/123" prefetch="intent">Post</Link>
```

### NavLink (활성 상태)
```typescript
import { NavLink } from "@remix-run/react";

<NavLink
  to="/dashboard"
  className={({ isActive }) => isActive ? "active" : ""}
>
  Dashboard
</NavLink>
```

### useNavigate
```typescript
import { useNavigate } from "@remix-run/react";

const navigate = useNavigate();

const handleClick = () => {
  navigate("/success");
};
```

---

## ⚠️ 에러 처리

### ErrorBoundary
```typescript
import { useRouteError, isRouteErrorResponse } from "@remix-run/react";

export function ErrorBoundary() {
  const error = useRouteError();

  if (isRouteErrorResponse(error)) {
    return (
      <div>
        <h1>{error.status} {error.statusText}</h1>
        <p>{error.data}</p>
      </div>
    );
  }

  return <div>예상치 못한 오류 발생</div>;
}
```

---

## 🏷️ 메타데이터

### Meta 함수
```typescript
import { MetaFunction } from "@remix-run/node";

export const meta: MetaFunction = () => {
  return [
    { title: "페이지 제목" },
    { name: "description", content: "페이지 설명" },
    { property: "og:title", content: "소셜 미디어 제목" }
  ];
};
```

### 동적 Meta
```typescript
export const meta: MetaFunction<typeof loader> = ({ data }) => {
  return [
    { title: data.post.title },
    { name: "description", content: data.post.excerpt }
  ];
};
```

---

## 🔗 Links

### Links 함수
```typescript
import { LinksFunction } from "@remix-run/node";
import styles from "~/styles/app.css";

export const links: LinksFunction = () => {
  return [
    { rel: "stylesheet", href: styles },
    { rel: "icon", href: "/favicon.ico" }
  ];
};
```

---

## 🍪 세션 관리

### 세션 생성
```typescript
import { createCookieSessionStorage } from "@remix-run/node";

const { getSession, commitSession, destroySession } =
  createCookieSessionStorage({
    cookie: {
      name: "session",
      secure: process.env.NODE_ENV === "production",
      secrets: [process.env.SESSION_SECRET],
      sameSite: "lax",
      path: "/",
      maxAge: 60 * 60 * 24 * 30, // 30일
      httpOnly: true
    }
  });
```

### 세션 읽기/쓰기
```typescript
// 읽기
const session = await getSession(request.headers.get("Cookie"));
const userId = session.get("userId");

// 쓰기
session.set("userId", "123");
return redirect("/dashboard", {
  headers: {
    "Set-Cookie": await commitSession(session)
  }
});

// 삭제
return redirect("/", {
  headers: {
    "Set-Cookie": await destroySession(session)
  }
});
```

---

## 🎨 스타일링

### CSS 파일 임포트
```typescript
import { LinksFunction } from "@remix-run/node";
import styles from "./styles.css";

export const links: LinksFunction = () => [
  { rel: "stylesheet", href: styles }
];
```

### Tailwind CSS
```typescript
// remix.config.js
module.exports = {
  tailwind: true,
};

// app/root.tsx
import styles from "./tailwind.css";

export const links: LinksFunction = () => [
  { rel: "stylesheet", href: styles }
];
```

---

## 📦 환경 변수

### 서버 전용
```typescript
// .env
DATABASE_URL=postgresql://...
SESSION_SECRET=abc123

// 서버에서 사용
const dbUrl = process.env.DATABASE_URL;
```

### 클라이언트에서 사용
```typescript
// remix.config.js
module.exports = {
  serverBuildTarget: "vercel",
  server: process.env.NODE_ENV === "development" ? undefined : "./server.js",
  ignoredRouteFiles: ["**/.*"],
  appDirectory: "app",
  assetsBuildDirectory: "public/build",
  serverBuildPath: "api/index.js",
  publicPath: "/build/",
  future: {
    v2_routeConvention: true,
  },
  serverDependenciesToBundle: [
    /^remix-utils.*/,
  ],
};

// 환경변수 사용
const apiKey = process.env.PUBLIC_API_KEY;
```

---

## 🚀 성능 최적화

### 캐싱 헤더
```typescript
export const headers = () => ({
  "Cache-Control": "public, max-age=300, s-maxage=3600"
});
```

### Prefetch
```typescript
<Link to="/slow-page" prefetch="intent">
  느린 페이지
</Link>
```

### Deferred Data
```typescript
import { defer } from "@remix-run/node";
import { Await, useLoaderData } from "@remix-run/react";
import { Suspense } from "react";

export const loader = async () => {
  return defer({
    fast: await getFastData(),
    slow: getSlowData() // await 없음
  });
};

export default function Page() {
  const { fast, slow } = useLoaderData<typeof loader>();

  return (
    <div>
      <div>{fast}</div>

      <Suspense fallback={<div>로딩...</div>}>
        <Await resolve={slow}>
          {(data) => <div>{data}</div>}
        </Await>
      </Suspense>
    </div>
  );
}
```

---

## 🔒 인증

### 사용자 확인
```typescript
export const loader = async ({ request }: LoaderFunctionArgs) => {
  const userId = await getUserId(request);

  if (!userId) {
    throw redirect("/login");
  }

  return json({ user: await getUser(userId) });
};
```

### 로그인
```typescript
export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();
  const email = formData.get("email");
  const password = formData.get("password");

  const user = await login(email, password);

  if (!user) {
    return json({ error: "Invalid credentials" }, { status: 401 });
  }

  return createUserSession(user.id, "/dashboard");
};
```

---

## 🧪 타입 안정성

### Loader 타입
```typescript
export const loader = async () => {
  return json({ message: "Hello" });
};

export default function MyRoute() {
  // 타입 자동 추론
  const data = useLoaderData<typeof loader>();
  //    ^? { message: string }
}
```

### Zod 유효성 검증
```typescript
import { z } from "zod";

const Schema = z.object({
  email: z.string().email(),
  password: z.string().min(8)
});

export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();

  const result = Schema.safeParse({
    email: formData.get("email"),
    password: formData.get("password")
  });

  if (!result.success) {
    return json({ errors: result.error.flatten() }, { status: 400 });
  }

  // result.data는 타입 안전
  const { email, password } = result.data;
};
```

---

## 🛠️ 유용한 유틸리티

### 현재 경로 확인
```typescript
import { useLocation } from "@remix-run/react";

const location = useLocation();
console.log(location.pathname); // "/posts/123"
```

### 매칭된 라우트 확인
```typescript
import { useMatches } from "@remix-run/react";

const matches = useMatches();
// 현재 라우트 계층 구조
```

### 재검증
```typescript
import { useRevalidator } from "@remix-run/react";

const revalidator = useRevalidator();

const handleRefresh = () => {
  revalidator.revalidate();
};
```

---

## 📱 자주 사용하는 패턴

### 낙관적 UI
```typescript
const fetcher = useFetcher();

const isCompleted = fetcher.formData
  ? fetcher.formData.get("completed") === "true"
  : todo.completed;
```

### 무한 스크롤
```typescript
const fetcher = useFetcher<typeof loader>();

useEffect(() => {
  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting && hasMore) {
      fetcher.load(`?page=${page + 1}`);
    }
  });

  // ...
}, [hasMore, page]);
```

### 자동 저장
```typescript
const fetcher = useFetcher();
const [content, setContent] = useState("");
const debouncedContent = useDebounce(content, 1000);

useEffect(() => {
  const formData = new FormData();
  formData.append("content", debouncedContent);
  fetcher.submit(formData, { method: "post" });
}, [debouncedContent]);
```

---

## 🎯 빠른 참조 요약

| 작업 | 사용할 것 |
|------|----------|
| 데이터 가져오기 | `loader` |
| 데이터 변경 | `action` |
| 페이지 이동 | `<Link>` |
| 비동기 작업 | `useFetcher` |
| 로딩 상태 | `useNavigation` |
| 에러 처리 | `ErrorBoundary` |
| SEO | `meta` |
| 스타일 | `links` |
| 세션 | `createCookieSessionStorage` |
| 환경 변수 | `process.env.*` |

---

**이 치트 시트를 북마크하고 자주 참조하세요! 📌**
